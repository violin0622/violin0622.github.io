<!DOCTYPE html>
<html lang="en">
  <head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noodp"/>
  <meta name="author" content="Violin">
  <meta name="description" content="violin sonata">
  <meta name="keywords" content="[Hugo blog]">
  
  <link rel="prev" href="https://violin0622.github.io/2019/configmap/" />
  <link rel="next" href="https://violin0622.github.io/2020/access-host-network-in-docker/" />
  <link rel="canonical" href="https://violin0622.github.io/2020/useful-operates-in-mysql/" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
  <title>
       
       
           MySQLå¸¸ç”¨æ“ä½œ | Sonata for solo Violin
       
  </title>
  <meta name="title" content="MySQLå¸¸ç”¨æ“ä½œ | Sonata for solo Violin">
    
  
  <link rel="stylesheet" href="/font/iconfont.css">
  <link rel="stylesheet" href="/css/main.min.css">


  
  
 

<script type="application/ld+json">
 "@context" : "http://schema.org",
    "@type" : "BlogPosting",
    "mainEntityOfPage": {
         "@type": "WebPage",
         "@id": "https:\/\/violin0622.github.io\/"
    },
    "articleSection" : "post",
    "name" : "MySQLå¸¸ç”¨æ“ä½œ",
    "headline" : "MySQLå¸¸ç”¨æ“ä½œ",
    "description" : "æ•°æ®åº“æ¦‚å¿µå…³ç³» æœåŠ¡å™¨ -\x26gt; å®ä¾‹ -\x26gt; æ•°æ®åº“ -\x26gt; è¡¨ -\x26gt; è®°å½• ç™»å½•æ•°æ®åº“å®ä¾‹ mysql \\ -u{ç”¨æˆ·å} \\ #å¦‚æœä¸æŒ‡å®š-uï¼Œ åˆ™ä½¿ç”¨ root ç”¨æˆ·ã€‚ -p{å¯†ç } \\ #å¦‚æœæŒ‡å®š-pè€Œ",
    "inLanguage" : "en",
    "author" : "Violin",
    "creator" : "Violin",
    "publisher": "Violin",
    "accountablePerson" : "Violin",
    "copyrightHolder" : "Violin",
    "copyrightYear" : "2020",
    "datePublished": "2020-02-19 15:14:38 \x2b0800 CST",
    "dateModified" : "2020-02-19 15:14:38 \x2b0800 CST",
    "url" : "https:\/\/violin0622.github.io\/2020\/useful-operates-in-mysql\/",
    "wordCount" : "1448",
    "keywords" : [ "MySQL", "Sonata for solo Violin"]
}
</script>

</head>

  


  <body class="">
    <div class="wrapper">
        <nav class="navbar">
    <div class="container">
        <div class="navbar-header header-logo">
        	<a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="https://violin0622.github.io/">Sonata for solo Violin</a>
        </div>
        <div class="menu navbar-right">
                
                
                <a class="menu-item" href="/post/" title="">Post</a>
                
                <a class="menu-item" href="/categories/" title="">Categories</a>
                
                <a class="menu-item" href="/tags/" title="">Tags</a>
                
                <a class="menu-item" href="/about/" title="">About</a>
                
        </div>
    </div>
</nav>
<nav class="navbar-mobile" id="nav-mobile" style="display: none">
     <div class="container">
        <div class="navbar-header">
            <div>  <a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="https://violin0622.github.io/">Sonata for solo Violin</a></div>
            <div class="menu-toggle">
                <span></span><span></span><span></span>
            </div>
        </div>
     
          <div class="menu" id="mobile-menu">
                
                
                <a class="menu-item" href="/post/" title="">Post</a>
                
                <a class="menu-item" href="/categories/" title="">Categories</a>
                
                <a class="menu-item" href="/tags/" title="">Tags</a>
                
                <a class="menu-item" href="/about/" title="">About</a>
                
        </div>
    </div>
</nav>

    	 <main class="main">
          <div class="container">
      		
<article class="post-warp" itemscope itemtype="http://schema.org/Article">
    <header class="post-header">
        <h1 class="post-title" itemprop="name headline">MySQLå¸¸ç”¨æ“ä½œ</h1>
        <div class="post-meta">
                Written by <a itemprop="name" href="https://violin0622.github.io/" rel="author">Violin</a> 
                <span class="post-time">
                on <time datetime=2020-02-19 itemprop="datePublished">2020-02-19</time>
                </span>
                in
                <i class="iconfont icon-folder"></i>
                <span class="post-category">
                        <a href="https://violin0622.github.io/categories/middleware/"> Middleware </a>
                        
                </span>
        </div>
    </header>
    <div class="post-content">
        

        

        
        
     
          
          
          

          
          
          

          

<h2 id="æ•°æ®åº“æ¦‚å¿µå…³ç³»">æ•°æ®åº“æ¦‚å¿µå…³ç³»</h2>

<p>æœåŠ¡å™¨ -&gt; å®ä¾‹ -&gt; æ•°æ®åº“ -&gt; è¡¨ -&gt; è®°å½•</p>

<h2 id="ç™»å½•æ•°æ®åº“å®ä¾‹">ç™»å½•æ•°æ®åº“å®ä¾‹</h2>

<pre><code class="language-sh">mysql  \
    -u{ç”¨æˆ·å}  \   #å¦‚æœä¸æŒ‡å®š-uï¼Œ åˆ™ä½¿ç”¨ root ç”¨æˆ·ã€‚
    -p{å¯†ç } \      #å¦‚æœæŒ‡å®š-pè€Œä¸è¾“å…¥å¯†ç ï¼Œ åˆ™ä¼šåœ¨äº¤äº’å¼ç•Œé¢ä¸­è¯¢é—®å¯†ç ã€‚ è¿™æ ·å¯ä»¥é¿å…å¯†ç æ³„æ¼ã€‚ 
    -h{ä¸»æœºåœ°å€} \
    -P{æœåŠ¡ç«¯å£}

</code></pre>

<h2 id="å¸¸ç”¨ä¿¡æ¯æŸ¥çœ‹">å¸¸ç”¨ä¿¡æ¯æŸ¥çœ‹</h2>

<pre><code class="language-sql">select user();      -- å½“å‰ç”¨æˆ·
select database();  -- å½“å‰æ•°æ®åº“
select version();   -- å½“å‰ç‰ˆæœ¬
select now();       -- å½“å‰æ—¶é—´
</code></pre>

<h2 id="æ•°æ®åº“ç®¡ç†">æ•°æ®åº“ç®¡ç†</h2>

<h3 id="åˆ›å»ºæ•°æ®åº“">åˆ›å»ºæ•°æ®åº“</h3>

<pre><code class="language-sql">create database {æ•°æ®åº“å}
    character set {å­—ç¬¦é›†}      -- å¯é€‰å‚æ•°
    collate {æ£€æŸ¥å}            -- å¯é€‰å‚æ•°
    default encryption {Y/N};   -- å¯é€‰å‚æ•°
</code></pre>

<p><code>charactor set</code> ç”¨äºæŒ‡å®šæ•°æ®åº“çº§åˆ«çš„å­—ç¬¦é›†ã€‚ ä»MySQL8.0å¼€å§‹ï¼Œ é»˜è®¤å­—ç¬¦é›†æ˜¯<code>utf8mb4</code>, è¿™æ˜¯ä¸€ç§æ”¯æŒ emoji è¡¨æƒ…çš„utf8å­—ç¬¦é›†ã€‚ ğŸ‰<br />
<code>collate</code> ç”¨äºæŒ‡å®šæ•°æ®åº“çº§åˆ«çš„å­—ç¬¦å‹æ•°æ®æ’åºè§„åˆ™ã€‚ ä»8.0ä¹‹åï¼Œ æ’åºè§„åˆ™é»˜è®¤ä¸º<code>utf8mb4_0900_ai_ci</code>ã€‚ ä¸€èˆ¬ä¸ç”¨æ”¹ã€‚<br />
<code>encryption</code> ç”¨äºæŒ‡å®šæ•°æ®åº“çš„åŠ å¯†ç®—æ³•ã€‚ é»˜è®¤ä¸ºä¸ä½¿ç”¨åŠ å¯†ã€‚</p>

<h3 id="æŸ¥çœ‹-åˆ é™¤æ•°æ®åº“">æŸ¥çœ‹/åˆ é™¤æ•°æ®åº“</h3>

<pre><code class="language-sql">show databases;              -- æŸ¥çœ‹æ‰€æœ‰æ•°æ®åº“
drop database {æ•°æ®åº“å};   -- åˆ é™¤æŒ‡å®šåç§°çš„æ•°æ®åº“
</code></pre>

<h3 id="å¯¼å‡ºæ•°æ®">å¯¼å‡ºæ•°æ®</h3>

<p><code>æ³¨æ„</code>ï¼šå¦‚æœåœ¨å‘½ä»¤è¡ŒæŒ‡å®šäº†-pï¼Œ åˆ™å¯¼å‡ºçš„sqlæ–‡ä»¶ç¬¬ä¸€è¡Œä¼šæœ‰ä¸ªwarnningï¼š<br />
&gt; mysqldump: [Warning] Using a password on the command line interface can be insecure.</p>

<p>è¿™è¡Œwariningä¸æ˜¯æ³¨é‡Šï¼Œå› æ­¤åœ¨å…¶ä»–æ•°æ®åº“å¯¼å…¥æ—¶ä¼šæŠ¥è¯­æ³•é”™è¯¯ã€‚ è§£å†³åŠæ³•æœ‰ä¸¤ä¸ª:<br />
1. åœ¨å¯¼å‡ºå‘½ä»¤ä¸­ä¸æŒ‡å®š<code>-p</code>å‚æ•°ï¼Œ ä½¿ç”¨äº¤äº’æ–¹å¼è¾“å…¥å¯†ç ã€‚ã€æ¨èã€‘
2. åœ¨å¯¼å‡ºçš„sqlæ–‡ä»¶ä¸­å°†è¿™ä¸€è¡Œåˆ é™¤æˆ–æ³¨é‡Šæ‰ã€‚</p>

<pre><code class="language-sh">mysqldump -u{ç”¨æˆ·å} -p{å¯†ç } \
  -h{ä¸»æœºåœ°å€} -P{ç«¯å£} \
  {æ•°æ®åº“å}            #å¦‚æœè¦å¯¼å‡ºæ‰€æœ‰æ•°æ®åº“ï¼Œ åˆ™åº“åè¡¨åéƒ½ä¸ç”¨æŒ‡å®šã€‚ \
  {æ•°æ®è¡¨å}            #å¦‚æœè¦å¯¼å‡ºå•ä¸ªæ•°æ®åº“æ‰€æœ‰è¡¨ï¼Œåˆ™è¡¨åä¸ç”¨æŒ‡å®šã€‚ \
   &gt; backup.sql         #é‡å®šå‘åˆ°å¤‡ä»½æ–‡ä»¶ä¸­ã€‚ 
</code></pre>

<h3 id="å¯¼å…¥æ•°æ®">å¯¼å…¥æ•°æ®</h3>

<p>é¦–å…ˆç™»é™†æ•°æ®åº“ï¼Œ åˆ›å»ºæ•°æ®åº“ä¸ç”¨æˆ·ï¼Œ å¹¶ä¸ºç”¨æˆ·åˆ†é…æƒé™ã€‚</p>

<pre><code class="language-sh">mysql -u{ç”¨æˆ·å} -p{å¯†ç } -h{ä¸»æœºåœ°å€} -P{ç«¯å£} {æ•°æ®åº“å} &lt; backup.sql
</code></pre>

<h3 id="å¯¼å‡ºæ•°æ®-dockerå†…">å¯¼å‡ºæ•°æ®ï¼ˆdockerå†…ï¼‰</h3>

<pre><code class="language-sh">docker exec -it mysql-instance mysqldump -u{user} -p{password} &gt; backup.sql
</code></pre>

<h3 id="å¯¼å…¥æ•°æ®-dockerå†…">å¯¼å…¥æ•°æ®ï¼ˆdockerå†…ï¼‰</h3>

<p>é¦–å…ˆå°†æ–‡ä»¶æ‹·è´åˆ°dockerå†…ï¼Œ ç„¶ååœ¨å®¹å™¨å†…çš„å‘½ä»¤è¡Œæ‰§è¡Œå¯¼å…¥å‘½ä»¤ã€‚</p>

<pre><code class="language-sh">docker cp ./backup.sql mysql-instance:/tmp/backup.sql
docker exec mysql-instance 'mysql -u{user} -p{password} source /tmp/backup.sql'
</code></pre>

<h2 id="ç”¨æˆ·ç®¡ç†">ç”¨æˆ·ç®¡ç†</h2>

<h3 id="æŸ¥çœ‹ç³»ç»Ÿå†…æ‰€æœ‰ç”¨æˆ·åŠç™»å½•åœ°å€">æŸ¥çœ‹ç³»ç»Ÿå†…æ‰€æœ‰ç”¨æˆ·åŠç™»å½•åœ°å€</h3>

<pre><code class="language-sql">select distinct 
    concat('user: ''',user,'''@''',host,''';') as query 
    from mysql.user;
</code></pre>

<h3 id="æŸ¥çœ‹æŸä¸ªç”¨æˆ·çš„æ‰€æœ‰æƒé™">æŸ¥çœ‹æŸä¸ªç”¨æˆ·çš„æ‰€æœ‰æƒé™</h3>

<pre><code class="language-sql">select * from mysql.user where user={ç”¨æˆ·å};
</code></pre>

<p>åœ¨<code>mysql.user</code>ä¸­ï¼Œ userå’Œhostä¸¤ä¸ªå­—æ®µå…±åŒæ„æˆä¸»é”®ã€‚</p>

<h3 id="åˆ›å»ºç”¨æˆ·ä¸æˆæƒ">åˆ›å»ºç”¨æˆ·ä¸æˆæƒ</h3>

<pre><code class="language-sql">-- åˆ›å»ºä¸æˆæƒåˆ†ä¸¤æ­¥
create user '{ç”¨æˆ·å}'@'{ä¸»æœºåŸŸ}' identified by '{å¯†ç }';
grant {æƒé™åˆ—è¡¨} on {æ•°æ®åº“å}.{æ•°æ®è¡¨å} to '{ç”¨æˆ·å}'@'{ä¸»æœºåŸŸ}';
-- åˆ†é…æ‰€æœ‰æƒé™
grant all on *.* to 'admin'@'localhost';
-- æŸ¥çœ‹ç”¨æˆ·çš„æƒé™
show grants for '{ç”¨æˆ·å}'@'{ä¸»æœºåŸŸ}';
</code></pre>

<p>åˆ›å»ºç”¨æˆ·æ—¶éœ€è¦åŒæ—¶æŒ‡å®šç”¨æˆ·åå’Œä¸»æœºåŸŸï¼Œ å› ä¸ºå®ƒä»¬å…±åŒæ„æˆ<code>mysql.user</code>çš„ä¸»é”®ã€‚ å¦‚æœä¸é™åˆ¶è¯¥ç”¨æˆ·å¯ä»¥åœ¨å“ªå°ä¸»æœºè®¿é—®ï¼Œ åˆ™ä¸»æœºåŸŸå¯ä»¥è®¾å®šä¸º<code>%</code>ï¼Œ ä»£è¡¨ä»»æ„ä¸»æœºã€‚ å¦‚æœä¸æŒ‡å®šä¸»æœºåŸŸï¼Œ åŒæ ·ä½¿ç”¨<code>%</code>ä½œä¸ºé»˜è®¤å€¼ã€‚</p>

<h2 id="æ•°æ®è¡¨ç®¡ç†">æ•°æ®è¡¨ç®¡ç†</h2>

<h3 id="å»ºè¡¨">å»ºè¡¨</h3>

<pre><code class="language-sql">create table è¡¨å(
    -- not null, default, auto_increment, comment éƒ½æ˜¯å¯é€‰å‚æ•°
    id int not null  auto_increment comment 'ä¸»é”®',   
    name varchar(10) not null default '' comment 'åå­—',
    primary key(`id`),
    unique key `kç´¢å¼•å` (`name`) -- æœ€åä¸€è¡Œä¸èƒ½ä»¥é€—å·ç»“å°¾
)charset=utf8mb4;
</code></pre>

<h3 id="ä¿®æ”¹è¡¨">ä¿®æ”¹è¡¨</h3>

<h4 id="æ–°åŠ å­—æ®µ">æ–°åŠ å­—æ®µ</h4>

<pre><code class="language-sql">-- åä¸€ä¸ªåˆ—åç”¨äºæŒ‡å®šæ–°åˆ—çš„ä½ç½®
alter table è¡¨å add column å­—æ®µå enum('M','F') not null after åˆ—å;
-- å°†æ–°å­—æ®µè®¾ç½®ä¸ºç¬¬ä¸€åˆ—
alter table è¡¨å add column å­—æ®µå enum('M','F') not null first;
</code></pre>

<h4 id="åˆ é™¤å­—æ®µ">åˆ é™¤å­—æ®µ</h4>

<pre><code class="language-sql">alter table è¡¨å drop å­—æ®µå;
</code></pre>

<h4 id="æ›´æ–°å­—æ®µ">æ›´æ–°å­—æ®µ</h4>

<pre><code class="language-sql">alter table è¡¨å change å­—æ®µå enum('M','F') not null ;
</code></pre>

<h4 id="ä¿®æ”¹å­—æ®µæ•°æ®ç±»å‹">ä¿®æ”¹å­—æ®µæ•°æ®ç±»å‹</h4>

<pre><code class="language-sql">alter table è¡¨å modify å­—æ®µå enum('M','F');
</code></pre>

<p>ä¿®æ”¹å­—æ®µæ•°æ®ç±»å‹ä¹‹åï¼Œ å…¶ä»–çš„é…ç½®å¦‚ not null ç­‰ä¸ä¼šå˜ã€‚</p>

<h4 id="æ·»åŠ -åˆ é™¤å­—æ®µé»˜è®¤å€¼">æ·»åŠ /åˆ é™¤å­—æ®µé»˜è®¤å€¼</h4>

<pre><code class="language-sql">alter table è¡¨å alter å­—æ®µå set default é»˜è®¤å€¼;
alter table è¡¨å alter å­—æ®µå drop default;
</code></pre>

<h3 id="é‡å‘½åè¡¨å">é‡å‘½åè¡¨å</h3>

<pre><code class="language-sql">alter table è¡¨å rename to æ–°è¡¨å;
</code></pre>

<h2 id="ç´¢å¼•ç®¡ç†">ç´¢å¼•ç®¡ç†</h2>

<p>é™¤äº†å¯ä»¥åœ¨åˆ›å»ºæ•°æ®è¡¨ç­‰æ—¶å€™æŒ‡å®šç´¢å¼•ä¹‹å¤–ï¼Œ è¿˜å¯ä»¥å•ç‹¬å¯¹ç´¢å¼•è¿›è¡Œç®¡ç†ã€‚</p>

<h3 id="æŸ¥çœ‹ç´¢å¼•">æŸ¥çœ‹ç´¢å¼•</h3>

<pre><code class="language-sql">show table from è¡¨å;
</code></pre>

<h3 id="åˆ›å»ºç´¢å¼•">åˆ›å»ºç´¢å¼•</h3>

<pre><code class="language-sql">create index ç´¢å¼•å on è¡¨å(å­—æ®µå);
-- åˆ›å»ºå”¯ä¸€ç´¢å¼•
create unique index ç´¢å¼•å on è¡¨å(å­—æ®µå);
</code></pre>

<h3 id="åˆ é™¤ç´¢å¼•">åˆ é™¤ç´¢å¼•</h3>

<pre><code class="language-sql">drop index ç´¢å¼•å on è¡¨å;
alter table  è¡¨å drop index ç´¢å¼•å;
</code></pre>

    </div>

    <div class="post-copyright">
             
            <p class="copyright-item">
                <span>Author:</span>
                <span>Violin </span>
                </p>
            
           
             
            <p class="copyright-item">
                    <span>Link:</span>
                    <a href=https://violin0622.github.io/2020/useful-operates-in-mysql/>https://violin0622.github.io/2020/useful-operates-in-mysql/</span>
            </p>
            
            
    </div>

  
    <div class="post-tags">
        
            <section>
            <i class="iconfont icon-tag"></i>Tag(s): 
            
            <span class="tag"><a href="https://violin0622.github.io/tags/mysql/">
                    #MySQL</a></span>
            
            </section>
        
        <section>
                <a href="javascript:window.history.back();">back</a></span> Â· 
                <span><a href="https://violin0622.github.io/">home</a></span>
        </section>
    </div>

    <div class="post-nav">
        
        <a href="https://violin0622.github.io/2019/configmap/" class="prev" rel="prev" title="Kubernetesä¸­çš„å®¹å™¨é…ç½®ç®¡ç†ï¼šConfigMap"><i class="iconfont icon-left"></i>&nbsp;Kubernetesä¸­çš„å®¹å™¨é…ç½®ç®¡ç†ï¼šConfigMap</a>
         
        
        <a href="https://violin0622.github.io/2020/access-host-network-in-docker/" class="next" rel="next" title="Dockerå®¹å™¨ä¸­è®¿é—®å®¿ä¸»æœºç½‘ç»œ">Dockerå®¹å™¨ä¸­è®¿é—®å®¿ä¸»æœºç½‘ç»œ&nbsp;<i class="iconfont icon-right"></i></a>
        
    </div>

    <div class="post-comment">
          
                 
          
    </div>
</article>
          </div>
		   </main>
      <footer class="footer">
    <div class="copyright">
        &copy;
        
        <span itemprop="copyrightYear">2017 - 2020</span>
        
        <span class="with-love">
    	 <i class="iconfont icon-love"></i> 
         </span>
         
            <span class="author" itemprop="copyrightHolder"><a href="https://violin0622.github.io/">Violin</a> | </span> 
         

         
		  <span>Powered by <a href="https://gohugo.io/" target="_blank" rel="external nofollow">Hugo</a> & <a href="https://github.com/liuzc/leaveit" target="_blank" rel="external nofollow">LeaveIt</a></span> 
    </div>
</footer>












    
    
    <script src="/js/vendor_no_gallery.min.js" async=""></script>
    
  



     </div>
  </body>
</html>
